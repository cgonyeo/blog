<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Gonblag</title>
    <meta name="description" content="">
    <meta name="author" content="Derek Gonyeo">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://blog.gonyeo.com/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-icons.min.css" rel="stylesheet">
    <link href="http://blog.gonyeo.com/theme/local.css" rel="stylesheet">
    <link href="http://blog.gonyeo.com/theme/pygments.css" rel="stylesheet">
    <link href="http://blog.gonyeo.com/theme/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Gudea:400,400italic|Alegreya+SC' rel='stylesheet' type='text/css'>
</head>

<body>
<header class="blog-header">
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
	<a href="http://blog.gonyeo.com" class="brand">Gonblag</a>
      </div>

      <div class="span3" id="blog-nav">
	<ul class="nav nav-pills pull-right">
            <li><a href="http://blog.gonyeo.com/pages/about-me.html">About Me</a></li>
	    <li >
	      <a href="http://blog.gonyeo.com/category/csh.html ">CSH</a>
	    <li >
	      <a href="http://blog.gonyeo.com/category/hfoss.html ">HFOSS</a>
	    <li >
	      <a href="http://blog.gonyeo.com/category/non-technical.html ">Non-Technical</a>
	    <li >
	      <a href="http://blog.gonyeo.com/category/odd.html ">ODD</a>
	</ul>
      </div>
    </div> <!-- End of fluid row-->
  </div>   <!-- End of Container-->
</header>
    
<div class="container">
    <div class="content">
    <div class="row-fluid">

        <div class="span10">
        

        

    <div class='row-fluid''>
        <div class="article-title span9">
            <a href="http://blog.gonyeo.com/deploying-logstash.html"><h1>Deploying Logstash</h1></a>
        </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
<p>Fri 31 January 2014 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.gonyeo.com/category/csh.html">CSH</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.gonyeo.com/tag/personal-projects.html">personal-projects</a> </p>
<p>
</p>
      </div>
      <div class="article-content span8">
	<p><a href="ihttp://logstash.net/">Logstash</a> is a program designed to collect, parse, and
store logs from Linux machines so that you can go through them and try to make
sense of them at a later date. I was tasked with deploying logstash on the
various computers that comprise the 
<a href="http://csh.rit.edu/">Computer Science House's</a> systems. This will detail the
steps I went through to do that.</p>
<p>There's multiple parts to logstash, the shipper, indexer, and web interface.
They all work together to collect, parse, and show you logs, and logs travel
through them in the above order.</p>
<p>The shipper is an instance of logstash that sits on a machine, and watches for 
new logs to be made. Upon finding these new logs, it grabs them and sends a copy
over to a <a href="http://redis.io/">Redis</a> instance somewhere. For the purpose of 
logstash, Redis is just a fancy queue. There will be a shipper running on every
computer you want to be viewing logs from, all talking to the same Redis
instace.</p>
<p>Next the indexer (another instance of the same binary) takes these logs out of
Redis at the other end of the queue, and saves them in to
<a href="http://www.elasticsearch.org/">Elasticsearch</a>.</p>
<p>Finally yet another instance of logstash sits on a machine, and serves up a web
page containing <a href="http://www.elasticsearch.org/overview/kibana/">Kibana</a> to view
and process these logs.</p>
<p>The first problem arises in that you get a .jar file from logstash's website,
and are instructed to run it with different flags to get the different modes
working. This is all fine and good to test out logstash, but we need something
more akin to a service for this. Some quick googling had revealed these
<a href="https://gist.github.com/jippi/1065761">init scripts</a> set up to make the running
of logstash more automated</p>
<p>Side Note: This was a couple months ago, and I'm not 100% positive those are 
the init scripts I used. Also I'm pretty sure those init scripts required some 
hacking on to get working, but I'll leave that as an exercise for the reader.</p>
<p>Anywho, the configs were stored in /etc/logstash/logstash-{shipper|indexer},
the pid files stored in /var/run/logstash/logstash-{shipper|indexer|web}.pid,
the logs were stored in /var/log/logstash/logstash-{shipper|indexer|web}.log,
and the init scripts stored in
/etc/init.d/logstash/logstash-{shipper|indexer|web}.</p>
<p>Another problem presented itself when I learned that Kibana uses the
Elasticsearch http apis to present the information to the user, and these are
not in any way secure. I'll edit this once I figure out what I'm going to do
about that.</p>
<p>Here's the configs I used for logstash when deploying it on my personal machine:</p>
<p>/etc/logstash/logstash-shipper</p>
<div class="highlight"><pre><span class="nb">input</span> <span class="p">{</span>
    <span class="n">stdin</span> <span class="p">{</span>
        <span class="nb">type</span> <span class="o">=&gt;</span> <span class="s">&quot;stdin-type&quot;</span>
    <span class="p">}</span>
    <span class="nb">file</span> <span class="p">{</span>
        <span class="nb">type</span> <span class="o">=&gt;</span> <span class="s">&quot;syslog&quot;</span>

        <span class="n">path</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s">&quot;/var/log/*.log&quot;</span><span class="p">,</span> <span class="s">&quot;/var/log/syslog&quot;</span><span class="p">,</span> <span class="s">&quot;/var/lib/plexmediaserver/Library/Application Support/Plex Media Server/Logs&quot;</span> <span class="p">]</span>
    <span class="p">}</span>
    <span class="nb">file</span> <span class="p">{</span>
        <span class="nb">type</span> <span class="o">=&gt;</span> <span class="s">&quot;messages&quot;</span>

        <span class="n">path</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s">&quot;/var/log/messages&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">output</span> <span class="p">{</span>
    <span class="n">stdout</span> <span class="p">{</span> <span class="n">codec</span> <span class="o">=&gt;</span> <span class="n">rubydebug</span> <span class="p">}</span>
    <span class="n">redis</span> <span class="p">{</span> <span class="n">host</span> <span class="o">=&gt;</span> <span class="s">&quot;127.0.0.1&quot;</span> <span class="n">data_type</span> <span class="o">=&gt;</span> <span class="s">&quot;list&quot;</span> <span class="n">key</span> <span class="o">=&gt;</span> <span class="s">&quot;logstash&quot;</span> <span class="n">password</span> <span class="o">=&gt;</span> <span class="n">tits123</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>/etc/logstash/logstash-indexer</p>
<div class="highlight"><pre><span class="nb">input</span> <span class="p">{</span>
  <span class="n">redis</span> <span class="p">{</span>
    <span class="n">host</span> <span class="o">=&gt;</span> <span class="s">&quot;127.0.0.1&quot;</span>
    <span class="c"># these settings should match the output of the agent</span>
    <span class="n">data_type</span> <span class="o">=&gt;</span> <span class="s">&quot;list&quot;</span>
    <span class="n">key</span> <span class="o">=&gt;</span> <span class="s">&quot;logstash&quot;</span>

    <span class="c"># We use the &#39;json&#39; codec here because we expect to read</span>
    <span class="c"># json events from redis.</span>
    <span class="n">codec</span> <span class="o">=&gt;</span> <span class="n">json</span>
    <span class="n">password</span> <span class="o">=&gt;</span> <span class="n">tits123</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">output</span> <span class="p">{</span>
  <span class="n">stdout</span> <span class="p">{</span> <span class="n">debug</span> <span class="o">=&gt;</span> <span class="n">true</span> <span class="p">}</span>

  <span class="n">elasticsearch</span> <span class="p">{</span>
    <span class="n">host</span> <span class="o">=&gt;</span> <span class="s">&quot;127.0.0.1&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Also here's a tiny script I wrote to deploy logstash onto a machine. It's not
the best, but might help provide insight to the steps necessary:</p>
<div class="highlight"><pre>mkdir -p /usr/local/bin/logstash /var/log/logstash /var/run/logstash /etc/logstash /etc/sysconfig
touch /var/log/logstash-shipper
wget https://download.elasticsearch.org/logstash/logstash/logstash-1.3.3-flatjar.jar -O /usr/local/bin/logstash/logstash.jar
scp -p derek@haruko.csh.rit.edu:/etc/init.d/logstash-shipper /etc/init.d/logstash-shipper
scp -p derek@haruko.csh.rit.edu:/etc/logstash/logstash-shipper.conf /etc/logstash/logstash-shipper.conf 
scp derek@haruko.csh.rit.edu:logstash-shipper /etc/sysconfig/logstash-shipper
chmod 640 /etc/sysconfig/logstash-shipper
</pre></div> 
	<a class="btn btn-mini xsmall" href="http://blog.gonyeo.com/deploying-logstash.html">
          <i class="icon-comment"></i> Comment </a>
	<hr />
      </div>
      
    </div>
    

 
        



    <div class='row-fluid'>
      <div class='article-title span9'> 
        <a href="http://blog.gonyeo.com/odd.html"><h1>ODD</h1></a>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
<p>Wed 29 January 2014 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.gonyeo.com/category/odd.html">ODD</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.gonyeo.com/tag/personal-projects.html">personal-projects</a> </p>
<p>
</p>
      </div>
      <div class="summary span8">
	<p>The One Dimensional Display</p> 
	<a class="btn btn-mini xsmall" href="http://blog.gonyeo.com/odd.html">
          <i class="icon-plus-sign"></i> Read More </a>
	<hr />
      </div>
      
    </div>
      
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://blog.gonyeo.com/tag/personal-projects.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        
    </div>     </div> </div>

<!--footer-->
<div class="container">
  <div class="well" style="background-color: #E9EFF6">
    <div id="blog-footer">
      <div class="row-fluid">
	<div class="social span2" align="center" id="socialist">
	  <ul class="nav nav-list">
	    <li class="nav-header">
	      Social
	    </li>
	    <li><a href="https://github.com/dgonyeo"><i class="icon-Github" style="color: #1f334b"></i>Github</a></li>
	    <li><a href="http://www.linkedin.com/pub/derek-gonyeo/41/7a6/412/"><i class="icon-LinkedIn" style="color: #1f334b"></i>LinkedIn</a></li>
            <a href="mailto:dgonyeo@csh.rit.edu"><i class="icon-envelope" style="color: #1f334b" ></i> email</a>

	  </ul>
	</div>
<div class="span8" id="colophon">
  <h2 align="center">Gonblag: Gonyeo's Blog</h2>
  <p align="justify"> Hi! I'm Derek! This is my blag! If you want to contact me to let me know how rad my blag is, there's some links to the left here. I'm also on freenode as dgonyeo in #rit-foss, if IRC is your thing. </p>
</div>
	<div class="site-nav span2" align="center">
          <ul class="nav nav-list" id="site-links">
            <li class="nav-header"> 
              Site
            </li>
            <li><a href="http://blog.gonyeo.com"><i class="icon-home" style="color: #1f334b">
                </i>Home</a></li>
            <li><a href="http://blog.gonyeo.com/archives.html"><i class="icon-list" style="color: #1f334b">
                </i>Archives</a></li>
	    <li><a href="http://blog.gonyeo.com/tags.html"><i class="icon-tags" style="color: #1f334b">
                </i>Tags</a></li>
	    
	    <li> <a href="http://blog.gonyeo.com/feeds/all.rss.xml" rel="alternate">
                <i class="icon-rss" style="color: #1f334b"></i>
                RSS Feed</a></li>
            <li><a href="http://blog.gonyeo.com/" rel="alternate">
                <i class="icon-rss-sign" style="color: #1f334b"></i>
                Atom Feed</a></li>
	  </ul>

        </div>

      </div> <!--end of fluid row-->
    </div> <!--end of blog-footer-->
    <hr />
    <p align="center"><a href="http://blog.gonyeo.com">Gonblag</a>
      &copy; Derek Gonyeo
    Powered by <a href="github.com/getpelican/pelican">Pelican</a> and
        <a href="https://twitter.github.com/bootstrap">Twitter Bootstrap</a>. 
        Icons by <a href="http://fortawesome.github.com/Font-Awesome">Font Awesome</a> and 
        <a href="http://gregoryloucas.github.com/Font-Awesome-More">Font Awesome More</a></p>

  </div> <!--end of well -->
</div> <!--end of container -->

<!--/footer-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>


<script>var _gaq=[['_setAccount','UA-47604400-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

</body>
</html>